C51 COMPILER V9.05   MAIN                                                                  06/03/2023 19:29:14 PAGE 1   


C51 COMPILER V9.05, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE main.c LARGE BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /************************************************************************************
   2             
   3          程序名称： （晶振频率18.432MHz） 
   4          功能说明: 通过串口3发送“Everything is possible!”  
   5                    波特率9600，数据位8，奇偶效验无，停止位1，数据流控制无  
   6          ************************************************************************************/
   7          #include "stc15f2k60s2.h"           // 单片机STC15F2K60S2头文件,可以不再加入reg51.h
   8          #include <intrins.h>                                    // 加入此头文件后,可使用_nop_库函数
   9          #include "delay.h"                      // 延时函数头文件
  10          #include "uart.h"                               // 串行通信函数头文件
  11          #define  uint unsigned int  
  12          #define  uchar unsigned char    
  13          #include <stdio.h>
  14          #include <string.h>
  15          #include "MODBUS.h"
  16          
  17          #include <stdio.h>
  18          #include <string.h>
  19          #include <stdlib.h>
  20          
  21          
  22          uint weishu1,weishu2,weishu3,weishu4;
  23          uchar buf1[100];
  24          uchar buf2[100];
  25          uchar buf3[100];
  26          uchar buf4[100];
  27          uint temp1,temp2,temp3,temp4;
  28          
  29          
  30          
  31          
  32          //sbit x0 = P4^3;
  33          //sbit x1 = P4^4; 
  34          //sbit x2 = P2^0; 
  35          //sbit x3 = P2^1;  
  36          //sbit x4 = P2^2;  
  37          //sbit x5 = P2^3;
  38          //sbit x6 = P2^4; 
  39          //sbit x7 = P2^5;
  40          //sbit x10 = P2^6;
  41          //sbit x11 = P2^7; 
  42          //sbit x12 = P4^5;
  43          //sbit x13 = P4^6;
  44          
  45          sbit x0 = P2^4; 
  46          sbit x1 = P2^5; 
  47          
  48          
  49          sbit x2 = P2^6;  
  50          sbit x3 = P2^7;
  51          
  52          sbit x4 = P4^5; 
  53          sbit x5 = P4^6;
  54          
  55          sbit x6 = P0^2;
C51 COMPILER V9.05   MAIN                                                                  06/03/2023 19:29:14 PAGE 2   

  56          sbit x7 = P0^3; 
  57          
  58          sbit x8 = P0^4; 
  59          sbit x9 = P5^2;
  60          
  61          
  62          
  63          
  64          sbit y0 = P2^3;  
  65          sbit y1 = P2^2; 
  66          sbit y2 = P2^1;
  67          sbit y3 = P2^0;
  68          sbit y4 = P4^4;
  69          sbit y5 = P4^3;
  70          
  71          
  72          
  73          void printf2(char *puts)
  74          {
  75   1               while(*puts) 
  76   1              {
  77   2                      sendbyte2(*puts);
  78   2                      puts++;
  79   2              }
  80   1      }
  81          
  82          void io_inint()
  83          {
  84   1              P0M1 = 0;       P0M0 = 0;       //设置P0.0~P0.7为准双向口
  85   1              P1M1 = 0;       P1M0 = 0;       //设置P1.0~P1.7为准双向口
  86   1              P2M1 = 0;       P2M0 = 0;       //设置P2.0~P2.7为准双向口 
  87   1              P3M1 = 0;       P3M0 = 0;       //设置P3.0~P3.7为准双向口
  88   1              P4M1 = 0;       P4M0 = 0;       //设置P4.0~P4.7为准双向口
  89   1              P5M1 = 0;       P5M0 = 0;       //设置P5.0~P5.7为准双向口
  90   1      }
  91          
  92          
  93          
  94          
  95          int xinget(int zhi)
  96          {
  97   1              if(zhi==0) return x0;
  98   1              if(zhi==1) return x1;
  99   1              if(zhi==2) return x2;
 100   1              if(zhi==3) return x3;
 101   1              if(zhi==4) return x4;
 102   1              if(zhi==5) return x5;
 103   1              if(zhi==6) return x6;
 104   1              if(zhi==7) return x7;
 105   1              if(zhi==8) return x8;
 106   1              if(zhi==9) return x9;
 107   1      }
 108          void getxin()
 109          {
 110   1              int i;
 111   1              char datatmp[10];
 112   1              for(i=0;i<10;i++)
 113   1              {
 114   2                      sprintf(datatmp,"x%d %d\n",i,xinget(i));
 115   2                      PrintString(datatmp);
 116   2              }
 117   1      }
C51 COMPILER V9.05   MAIN                                                                  06/03/2023 19:29:14 PAGE 3   

 118          void Delay1ms()         //@24.000MHz
 119          {
 120   1              unsigned char i, j;
 121   1      
 122   1              i = 24;
 123   1              j = 85;
 124   1              do
 125   1              {
 126   2                      while (--j);
 127   2              } while (--i);
 128   1      }
 129          
 130          void delay_ms(int m)
 131          {
 132   1              int x,y;
 133   1              for(x=m;x>0;x--)
 134   1              {
 135   2                      Delay1ms();
 136   2              }
 137   1              
 138   1      }
*** WARNING C280 IN LINE 132 OF main.c: 'y': unreferenced local variable
 139          
 140          void main()                                                    
 141          {
 142   1              
 143   1              io_inint();
 144   1              Uart23Init();
 145   1              
 146   1              
 147   1              Timer0Init();
 148   1              UartInit();
 149   1              
 150   1              Uart4Init();
 151   1              PrintString("system is ok\n");
 152   1              while (1)
 153   1              {
 154   2                      delay_ms(2);
 155   2                      // printf("0000000000");
 156   2                      if(recover==1)
 157   2                      {
 158   3                              
 159   3                              jishouokjisuan();
 160   3                              recover=0;
 161   3                      }
 162   2              }
 163   1      }
 164                   
 165                   
 166          
 167                   
 168                   
 169          uint time,lv_bo;
 170          void Timer0() interrupt 1
 171          {
 172   1              time1msjisuan();
 173   1      }
 174          char buffxxx[100]="";
 175          char buffweizhi=0;
 176          void dealrecI(char c)
 177          {
 178   1              
C51 COMPILER V9.05   MAIN                                                                  06/03/2023 19:29:14 PAGE 4   

 179   1      }
*** WARNING C280 IN LINE 176 OF main.c: 'c': unreferenced local variable
 180          void UARTInterrupt(void) interrupt 4
 181          {
 182   1              unsigned char ans;
 183   1              if (RI)
 184   1              {
 185   2                      RI = 0;
 186   2                      ans=SBUF;
 187   2                      chuankou1jisuuan(ans);
 188   2              }
 189   1              else
 190   1              {
 191   2                      TI = 0;
 192   2              }
 193   1              if (TI) //发送中断..
 194   1              {
 195   2                      TI = 0;
 196   2              }
 197   1      }
 198          
 199          void uart2(void ) interrupt 8 
 200          {
 201   1        if (S2CON & S2RI)
 202   1              {
 203   2                      S2CON &= ~S2RI;         
 204   2                      temp2 = S2BUF;
 205   2              }
 206   1        if (S2CON & S2TI)
 207   1          {
 208   2                              //y1=0;
 209   2              S2CON &= ~S2TI;         //清除S2TI位
 210   2              busy2 = 0;               //清忙标志
 211   2          }  
 212   1      }
 213          
 214            
 215          
 216          
 217          void Uart3() interrupt 17 using 1
 218          {
 219   1          if (S3CON & S3RI)
 220   1          {
 221   2              S3CON &= ~S3RI;         //??S3RI?
 222   2              temp3 = S3BUF;
 223   2                                      
 224   2         }
 225   1      if (S3CON & S3TI)
 226   1          {
 227   2              S3CON &= ~S3TI;         //清除S3TI位
 228   2              busy3 = 0;               //清忙标志
 229   2          }
 230   1      }
 231          
 232          void Uart4() interrupt 18 
 233          {
 234   1          if (S4CON & S4RI)
 235   1          {
 236   2              S4CON &= ~S4RI;         //??S4RI?
 237   2              temp4=S4BUF;
 238   2         }
 239   1      if(TI4)
C51 COMPILER V9.05   MAIN                                                                  06/03/2023 19:29:14 PAGE 5   

 240   1              {
 241   2                      CLR_TI4();
 242   2                      busy4 = 0;               //清忙标志
 243   2              }
 244   1      }
 245          
 246          
 247          
*** WARNING C291 IN LINE 107 OF main.c: not every exit path returns a value


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    652    ----
   CONSTANT SIZE    =     22    ----
   XDATA SIZE       =    521      18
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  3 WARNING(S),  0 ERROR(S)
